<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>烟花</title>
</head>
<style>
    *{margin: 0;padding: 0;}
</style>
<body>
    
</body>
<script type="text/javascript">
function Fire(){
    // 建立夜空
    this.night = document.createElement("div");
    this.setStyle(this.night,{  // 设置样式
        width:"1000px",
        height:"500px",
        background:"#1E135A",
        border:"yellow solid 5px",
        margin:"50px auto",
    });
    document.body.appendChild(this.night);
    this.night.onclick = e =>{  // 点击放烟花
        var e = e || window.event;
        var x = e.offsetX;
        var y = e.offsetY;
        div = document.createElement("div");
        this.setStyle(div,{
            width:"10px",
            height:"10px",
            position:"absolute",
            top:y + "px",
            lef:x + "px",
            borderRadius:"50%",
        })
        bgcolor(div);
        // 获取随机left
        var l = this.getRandom(0,this.night.clientWidth-10);
        // 获取随机top
        var t = this.getRandom(0,this.night.clientHeight-10);
        this.night.appendChild(div);
        move(div,{top:y},()=>{
        // 将上来的这个小火花干掉
        div.parentElement.removeChild(div);
        // 创建很多小火花
        var num = this.getRandom(30,35);
        for(let i= 0;i<num;i++){
            let div = document.createElement("div");
            div.setAttribute("aaa",i);
            this.setStyle(div,{
                width:"10px",
                height:"10px",
                position:"absolute",
                top:y + "px",
                lef:x + "px",
                borderRadius:"50%",
            })
            bgcolor(div);
            this.night.appendChild(div);
            // 获取随机left
            var l = this.getRandom(0,this.night.clientWidth-10);
            // 获取随机top
            var t = this.getRandom(0,this.night.clientHeight-10);
            move(div,{left:l,top:t},()=>{
                // 删除很多个小火花
                div.parentElement.removeChild(div)
            })
        }
    })
    }
}




Fire.prototype.setStyle = function(ele,styleObj){
    for(var attr in styleObj){
        ele["style"][attr] = styleObj[attr]
    }
}
var f = new Fire();

Fire.prototype.getRandom = function(a,b){
    return Math.floor(Math.random()*(a-b))+b;
}

function bgcolor(id){     // 获取随机背景颜色
    var str = "#";
    for(var i=0;i<6;i++){
        var res = parseInt(Math.random()*16);
        var str = str + res.toString(16);
    }
    id.style.background=str;
}

function move(ele,obj,fn=null){
    var timerObj = {}
    for(let attr in obj){
        let target = obj[attr];
        let currentStyle = parseInt(getStyle(ele,attr));
        if(attr == 'opacity'){
            currentStyle = currentStyle*100;
            target = target*100;
        }
        timerObj[attr] = setInterval(function(){
            let speed = target-currentStyle;
            let percent;
            if(speed<0){ 
                percent = Math.floor(speed/10); 
            }else{
                percent = Math.ceil(speed/10); 
            }
            currentStyle += percent;
            if(currentStyle==target){
                clearInterval(timerObj[attr]);
                delete timerObj[attr]
                var k=0;
                for(var i in timerObj){
                    k++;
                }
                if(k==0){
                    if(fn){
                        fn()
                    }
                }
            }else{
                if(attr == "opacity"){
                    ele.style[attr] = currentStyle/100;
                }else{
                    ele.style[attr] = currentStyle + 'px';
                }
            }
            
        },30);

    }   
}

function getStyle(ele,attr){
    if(window.getComputedStyle){
        return window.getComputedStyle(ele)[attr];
    }else{
        return ele.currentStyle[attr];
    }
}
</script>
</html>